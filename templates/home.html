<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>üéØ PPTeXpress</title>
            <link rel="stylesheet" href="/static/css/styles.css">
            <style>
                .home-container { max-width: 800px; margin: 40px auto; }
                .action-cards { display: flex; gap: 20px; margin-top: 30px; }
                .card { 
                    flex: 1; padding: 20px; background: white; 
                    border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    text-align: center;
                }
                .project-open-form { margin-top: 15px; }
                .project-open-form input { 
                    width: 100%; padding: 8px; margin-bottom: 10px;
                    border: 1px solid #ddd; border-radius: 4px;
                }
                /* projectbarstyle */
                .project-bar {
                    display: flex;
                    align-items: center;
                    justify-content: space-between;
                    padding: 15px;
                    margin: 10px 0;
                    background: #f8f9fa;
                    border-radius: 8px;
                    border: 1px solid #dee2e6;
                    transition: all 0.2s;
                }

                .project-bar:hover {
                    background: #e9ecef;
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }

                /* Project information area on the left */
                .project-info {
                    flex: 1;
                    cursor: default; /* Not clickable */
                }

                .project-title {
                    font-weight: bold;
                    font-size: 16px;
                    margin-bottom: 5px;
                    color: #333;
                }

                .project-meta {
                    font-size: 13px;
                    color: #666;
                    margin-bottom: 3px;
                }

                .project-date {
                    font-size: 12px;
                    color: #999;
                }

                /* Right button area */
                .project-actions {
                    display: flex;
                    gap: 8px;
                    margin-left: 15px;
                }

                .action-btn {
                    padding: 8px 12px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 13px;
                    font-weight: 500;
                    transition: all 0.2s;
                    display: flex;
                    align-items: center;
                    gap: 5px;
                }

                .open-btn {
                    background-color: #28a745;
                    color: white;
                }

                .open-btn:hover {
                    background-color: #218838;
                    transform: scale(1.05);
                }

                .export-btn {
                    background-color: #17a2b8;
                    color: white;
                }

                .export-btn:hover {
                    background-color: #138496;
                    transform: scale(1.05);
                }

                .delete-btn {
                    background-color: #dc3545;
                    color: white;
                }

                .delete-btn:hover {
                    background-color: #c82333;
                    transform: scale(1.05);
                }

                /* Invalid item style */
                .project-bar.invalid {
                    background: #fff3cd;
                    border-color: #ffeaa7;
                }

                .project-bar.invalid .project-info {
                    opacity: 0.7;
                }

                /* Delete confirmation dialog */
                .delete-confirm-overlay {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 1000;
                }

                .delete-confirm-dialog {
                    background: white;
                    padding: 25px;
                    border-radius: 10px;
                    max-width: 400px;
                    width: 90%;
                    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
                }

                .delete-confirm-dialog h4 {
                    margin-top: 0;
                    color: #dc3545;
                }

                .delete-confirm-dialog p {
                    margin: 15px 0;
                    line-height: 1.5;
                }

                .delete-confirm-actions {
                    display: flex;
                    justify-content: flex-end;
                    gap: 10px;
                    margin-top: 20px;
                }

                .cancel-btn {
                    padding: 8px 16px;
                    background: #6c757d;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }

                .confirm-delete-btn {
                    padding: 8px 16px;
                    background: #dc3545;
                    color: white;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                }
            </style>
        </head>
        <body>
            <div class="home-container">
                <h1>üéØ PPTeXpress</h1>
                
                <div class="action-cards">
                    <div class="card">
                        <h3>üì§ Create Project</h3>
                        <p>Create project from PPTX</p>
                        <button onclick="window.location.href='/new-project'">
                            Import PPTX
                        </button>
                    </div>
                    
                    <div class="card" style="display: none;">
                        <h3>üìñ Guide</h3>
                        <p>Understand how to manage projects</p>
                        <button onclick="showGuide()">Check Guide</button>
                    </div>
                </div>
                
                <div id="recent-projects" style="margin-top: 30px;">
                    <h3>All Projects</h3>
                    <div id="project-list" class="empty-state">
                        Loading projects...
                    </div>
                </div>
            </div>

            <script type="module">
            import { logger } from "/static/js/logger.js";            
            async function loadRecentProjects() {
                logger.debug("üîç Start loading recent projects...");
                try {
                    const response = await fetch('/api/recent-projects');
                    const data = await response.json();
                    logger.debug("üìä Receive project data:", data);
                    
                    const container = document.getElementById('project-list');
                    if (!container) {
                        logger.error("‚ùå Container not found: #project-list");
                        return;
                    }
                    
                    if (data.status === 'success' && data.projects) {
                        const projects = data.projects;
                        if (projects && projects.length > 0) {
                            logger.debug(`üìÅ Display ${projects.length} projects`);
                            let html = '';
                            
                            projects.forEach((project, index) => {
                                const createdDate = project.created_at ? 
                                    new Date(project.created_at).toLocaleDateString() : 'unknown';
                                const lastOpenedDate = project.last_opened ? 
                                    new Date(project.last_opened).toLocaleDateString() : 'unknown';
                                
                                html += `
                                    <div class="project-bar ${!project.valid ? 'invalid' : ''}" 
                                        id="project-${project.session_id}">
                                        <!-- Project information on the leftÔºàNot clickableÔºâ -->
                                        <div class="project-info">
                                            <div class="project-title">
                                                ${index + 1}. ${project.name || 'Unnamed project'}
                                                ${!project.valid ? '<span style="color: #dc3545; margin-left: 8px;">‚ö†Ô∏è</span>' : ''}
                                            </div>
                                            <div class="project-meta">
                                                üìÖ Create Date: ${createdDate} | 
                                                üìä Slides: ${project.slide_count || 0} | 
                                                üìÅ ID: ${project.id || project.session_id?.slice(0, 8)}
                                            </div>
                                            <div class="project-date">
                                                üîÑ Last Modified: ${lastOpenedDate}
                                            </div>
                                            ${!project.valid ? 
                                                '<div style="color: #dc3545; font-size: 12px; margin-top: 5px;">‚ö†Ô∏è There may be problems with the project</div>' : 
                                                ''
                                            }
                                        </div>
                                        
                                        <!-- Right operation button -->
                                        <div class="project-actions">
                                            <button class="action-btn open-btn" 
                                                    onclick="openProjectById('${project.session_id}')"
                                                    ${!project.valid ? 'disabled style="opacity:0.5;cursor:not-allowed;"' : ''}>
                                                <span>üìÇ</span> Open
                                            </button>
                                            <button class="action-btn export-btn" 
                                                    onclick="exportProject('${project.session_id}', '${project.name}')"
                                                    ${!project.valid ? 'disabled style="opacity:0.5;cursor:not-allowed;"' : ''}>
                                                <span>üì§</span> Export
                                            </button>
                                            <button class="action-btn delete-btn" 
                                                    onclick="confirmDeleteProject('${project.session_id}', '${project.name}')">
                                                <span>üóëÔ∏è</span> Delete
                                            </button>
                                        </div>
                                    </div>
                                `;
                            });
                            
                            container.innerHTML = html;
                            logger.debug("‚úÖ Project list updated");
                        } else {
                            logger.debug("üì≠ No items found");
                            container.innerHTML = '<div class="empty-state">No projects yetÔºåPlease create a project first</div>';
                        }
                    } else {
                        logger.error("‚ùå APIreturn error:", data.message);
                        container.innerHTML = `<div class="empty-state" style="color: #dc3545;">
                            ‚ùå Loading Failed: ${data.message || 'unknown error'}
                        </div>`;
                    }
                } catch (error) {
                    logger.error('‚ùå Failed to load recent items:', error);
                    const container = document.getElementById('project-list');
                    if (container) {
                        container.innerHTML = `<div class="empty-state" style="color: #dc3545;">
                            ‚ùå Request failed: ${error.message}
                        </div>`;
                    }
                }
            }

            // Open recent projects
            async function openProjectById(session_id) {
                logger.debug(`üîÑ Open project: ${session_id}`);
                try {
                    const response = await fetch(`/api/open-recent/${session_id}`);
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        logger.debug(`‚úÖ Open successfullyÔºåjump to: /editor/${data.session_id}`);
                        window.location.href = `/editor/${data.session_id}`;
                    } else {
                        alert('Failed to open project: ' + data.message);
                        // Reload project listÔºàThe project may have expiredÔºâ
                        loadRecentProjects();
                    }
                } catch (error) {
                    logger.error('Failed to open project:', error);
                    alert('Request failed: ' + error.message);
                }
            }

            // Export project
            async function exportProject(session_id, project_name) {
                logger.debug(`üì§ Export project: ${session_id} - ${project_name}`);
                
                // Show exporting status
                const projectBar = document.getElementById(`project-${session_id}`);
                const exportBtn = projectBar?.querySelector('.export-btn');
                if (exportBtn) {
                    exportBtn.innerHTML = '<span>‚è≥</span> Exporting...';
                    exportBtn.disabled = true;
                }
                
                try {
                    const response = await fetch(`/api/export/${session_id}`);
                    if (!response.ok) {
                        throw new Error(`HTTPmistake: ${response.status}`);
                    }
                    
                    // Handle file downloads
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${project_name || 'project'}_export_${new Date().toISOString().slice(0,10)}.pptx`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    logger.debug(`‚úÖ Export successful: ${project_name}`);
                    
                    // Restore button state
                    if (exportBtn) {
                        exportBtn.innerHTML = '<span>üì§</span> Export';
                        exportBtn.disabled = false;
                    }
                    
                } catch (error) {
                    logger.error('‚ùå Export project failed:', error);
                    alert('Export failed: ' + error.message);
                    
                    // Restore button state
                    if (exportBtn) {
                        exportBtn.innerHTML = '<span>üì§</span> Export';
                        exportBtn.disabled = false;
                    }
                }
            }

            // Confirm item deletion
            function confirmDeleteProject(session_id, project_name) {
                logger.debug(`üóëÔ∏è Confirm deletion: ${session_id} - ${project_name}`);
                
                // Create confirmation dialog
                const overlay = document.createElement('div');
                overlay.className = 'delete-confirm-overlay';
                overlay.innerHTML = `
                    <div class="delete-confirm-dialog">
                        <h4>üóëÔ∏è Confirm item deletion</h4>
                        <p>Are you sure you want to delete the project <strong>"${project_name}"</strong> ?Ôºü</p>
                        <p style="color: #dc3545; font-size: 13px;">
                            ‚ö†Ô∏è warnÔºöThis operation will permanently delete the project filesÔºåInclude all modification recordsÔºÅ
                        </p>
                        <div class="delete-confirm-actions">
                            <button class="cancel-btn" onclick="this.closest('.delete-confirm-overlay').remove()">
                                Cancel
                            </button>
                            <button class="confirm-delete-btn" onclick="deleteProject('${session_id}', '${project_name}')">
                                Confirm deletion
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                
                // Click on the background to close
                overlay.addEventListener('click', function(e) {
                    if (e.target === overlay) {
                        overlay.remove();
                    }
                });
            }

            // Delete project
            async function deleteProject(session_id, project_name) {
                logger.debug(`üóëÔ∏è Delete project: ${session_id} - ${project_name}`);
                
                // Remove confirmation dialog
                document.querySelector('.delete-confirm-overlay')?.remove();
                
                // Show deletion status
                const projectBar = document.getElementById(`project-${session_id}`);
                if (projectBar) {
                    projectBar.style.opacity = '0.5';
                    const deleteBtn = projectBar.querySelector('.delete-btn');
                    if (deleteBtn) {
                        deleteBtn.innerHTML = '<span>‚è≥</span> Deleting...';
                        deleteBtn.disabled = true;
                    }
                }
                
                try {
                    const response = await fetch(`/api/delete-project/${session_id}`, {
                        method: 'DELETE'
                    });
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        logger.debug(`‚úÖ Delete successfully: ${project_name}`);
                        
                        // Remove item from listÔºàfade out effectÔºâ
                        if (projectBar) {
                            projectBar.style.transition = 'all 0.3s';
                            projectBar.style.opacity = '0';
                            projectBar.style.height = '0';
                            projectBar.style.margin = '0';
                            projectBar.style.padding = '0';
                            projectBar.style.border = 'none';
                            projectBar.style.overflow = 'hidden';
                            
                            // Complete removal after delay
                            setTimeout(() => {
                                projectBar.remove();
                                
                                // if list is emptyÔºåshow hint
                                const container = document.getElementById('project-list');
                                if (container && container.children.length === 0) {
                                    container.innerHTML = '<div class="empty-state">No projects yetÔºåPlease create a project first</div>';
                                }
                            }, 300);
                        }
                    } else {
                        logger.error('‚ùå Delete failed:', data.message);
                        alert('Delete failed: ' + data.message);
                        
                        // Restore project bar status
                        if (projectBar) {
                            projectBar.style.opacity = '1';
                            const deleteBtn = projectBar.querySelector('.delete-btn');
                            if (deleteBtn) {
                                deleteBtn.innerHTML = '<span>üóëÔ∏è</span> delete';
                                deleteBtn.disabled = false;
                            }
                        }
                    }
                } catch (error) {
                    logger.error('‚ùå Failed to delete item:', error);
                    alert('Delete request failed: ' + error.message);
                    
                    // Restore project bar status
                    if (projectBar) {
                        projectBar.style.opacity = '1';
                        const deleteBtn = projectBar.querySelector('.delete-btn');
                        if (deleteBtn) {
                            deleteBtn.innerHTML = '<span>üóëÔ∏è</span> delete';
                            deleteBtn.disabled = false;
                        }
                    }
                }
            }
            window.deleteProject = deleteProject;
            window.openProjectById = openProjectById;
            window.exportProject = exportProject;
            window.confirmDeleteProject = confirmDeleteProject;

            document.addEventListener('DOMContentLoaded', function() {
                logger.debug("Loading recent projects")
                loadRecentProjects();
            });
            </script>
        </body>
        </html>